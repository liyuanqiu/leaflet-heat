"use strict";var t,i=require("leaflet"),a=(t=require("simpleheat"))&&"object"==typeof t&&"default"in t?t.default:t,s=i.Layer.extend({initialize:function(t,a){this._latlngs=t,i.Util.setOptions(this,a)},setLatLngs:function(t){return this._latlngs=t,this.redraw()},addLatLng:function(t){return this._latlngs.push(t),this.redraw()},setOptions:function(t){return i.Util.setOptions(this,t),this._heat&&this._updateOptions(),this.redraw()},redraw:function(){return this._heat&&!this._frame&&this._map&&!this._map._animating&&(this._frame=i.Util.requestAnimFrame(this._redraw,this)),this},onAdd:function(t){this._map=t,this._canvas||this._initCanvas(),this.options.pane?this.getPane().appendChild(this._canvas):t.getPanes().overlayPane.appendChild(this._canvas),t.on("moveend",this._reset,this),t.options.zoomAnimation&&i.Browser.any3d&&t.on("zoomanim",this._animateZoom,this),this._reset()},onRemove:function(t){this.options.pane?this.getPane().removeChild(this._canvas):t.getPanes().overlayPane.removeChild(this._canvas),t.off("moveend",this._reset,this),t.options.zoomAnimation&&t.off("zoomanim",this._animateZoom,this)},addTo:function(t){return t.addLayer(this),this},_initCanvas:function(){this._canvas=i.DomUtil.create("canvas","leaflet-heatmap-layer leaflet-layer");var t=this._canvas,s=i.DomUtil.testProp(["transformOrigin","WebkitTransformOrigin","msTransformOrigin"]);!1!==s&&(t.style[s]="50% 50%");var n=this._map.getSize();t.width=n.x,t.height=n.y,i.DomUtil.addClass(t,"leaflet-zoom-"+(this._map.options.zoomAnimation&&i.Browser.any3d?"animated":"hide")),this._heat=a(t),this._updateOptions()},_updateOptions:function(){this._heat.radius(this.options.radius||this._heat.defaultRadius,this.options.blur),this.options.gradient&&this._heat.gradient(this.options.gradient),this.options.max&&this._heat.max(this.options.max)},_reset:function(){var t=this._map.containerPointToLayerPoint([0,0]);i.DomUtil.setPosition(this._canvas,t);var a=this._map.getSize();this._heat._width!==a.x&&(this._heat._width=a.x,this._canvas.width=a.x),this._heat._height!==a.y&&(this._heat._height=a.y,this._canvas.height=a.y),this._redraw()},_redraw:function(){if(this._map){var t,a,s,n,e,o,h,r,m,_=[],l=this._heat._r,p=this._map.getSize(),d=new i.Bounds(i.point([-l,-l]),p.add([l,l])),f=void 0===this.options.max?1:this.options.max,u=void 0===this.options.maxZoom?this._map.getMaxZoom():this.options.maxZoom,g=1/Math.pow(2,Math.max(0,Math.min(u-this._map.getZoom(),12))),c=l/2,v=[],y=this._map._getMapPanePos(),x=y.x%c,w=y.y%c;for(t=0,a=this._latlngs.length;t<a;t+=1)if(s=this._map.latLngToContainerPoint(this._latlngs[t]),d.contains(s)){e=Math.floor((s.x-x)/c)+2,o=Math.floor((s.y-w)/c)+2;var P=1;void 0!==this._latlngs[t].alt?P=this._latlngs[t].alt:void 0!==this._latlngs[t][2]&&(P=+this._latlngs[t][2]),m=P*g,v[o]=v[o]||[],(n=v[o][e])?(n[0]=(n[0]*n[2]+s.x*m)/(n[2]+m),n[1]=(n[1]*n[2]+s.y*m)/(n[2]+m),n[2]+=m):v[o][e]=[s.x,s.y,m]}for(t=0,a=v.length;t<a;t+=1)if(v[t])for(h=0,r=v[t].length;h<r;h+=1)(n=v[t][h])&&_.push([Math.round(n[0]),Math.round(n[1]),Math.min(n[2],f)]);this._heat.data(_).draw(this.options.minOpacity),this._frame=null}},_animateZoom:function(t){var a=this._map.getZoomScale(t.zoom),s=this._map._getCenterOffset(t.center)._multiplyBy(-a).subtract(this._map._getMapPanePos());i.DomUtil.setTransform&&i.DomUtil.setTransform(this._canvas,s,a)}});exports.heatLayer=function(t,i){return new s(t,i)};
//# sourceMappingURL=leaflet-heat-es.cjs.production.min.js.map
